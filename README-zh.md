# Whisper-Server: å®æ—¶è¯­éŸ³è½¬æ–‡å­—è½¬å½•ç³»ç»Ÿ

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)
![OpenAI Whisper](https://img.shields.io/badge/AI-OpenAI%20Whisper-brightgreen)

ä¸€ä¸ªç”±OpenAIçš„Whisperæ¨¡å‹é©±åŠ¨çš„å®æ—¶è¯­éŸ³è½¬å½•ç³»ç»Ÿï¼Œå…·æœ‰ä½å»¶è¿ŸéŸ³é¢‘å¤„ç†çš„WebSocketæœåŠ¡å™¨å’ŒOBS Studioé›†æˆå®¢æˆ·ç«¯ã€‚

## ğŸŒŸ åŠŸèƒ½ç‰¹ç‚¹

- **å®æ—¶è½¬å½•** ä½¿ç”¨OpenAIçš„Whisper large-v3-turboæ¨¡å‹
- **åŸºäºWebSocketçš„é€šä¿¡** å®ç°é«˜æ•ˆçš„äºŒè¿›åˆ¶éŸ³é¢‘æµä¼ è¾“
- **å¤šè¯­è¨€æ”¯æŒ** æä¾›å…¨çƒè¯­è¨€æ— éšœç¢è®¿é—®
- **OBS Studioé›†æˆ** ç”¨äºç›´æ’­å­—å¹•/å­—å¹•æ˜¾ç¤º
- **ä½å»¶è¿Ÿå¤„ç†** é’ˆå¯¹å®æ—¶åº”ç”¨åœºæ™¯ä¼˜åŒ–
- **ç”¨æˆ·å‹å¥½çš„GUIå®¢æˆ·ç«¯** æä¾›é…ç½®ç®¡ç†åŠŸèƒ½

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

ç³»ç»Ÿç”±ä¸¤ä¸ªä¸»è¦ç»„ä»¶ç»„æˆï¼š

1. **Whisper WebSocketæœåŠ¡å™¨**:
   - é€šè¿‡WebSocketæ¥æ”¶å®æ—¶éŸ³é¢‘æµ
   - ä½¿ç”¨OpenAIçš„Whisperæ¨¡å‹å¤„ç†éŸ³é¢‘
   - å®æ—¶è¿”å›è½¬å½•ç»“æœ
   - ç®¡ç†å¤šä¸ªå¹¶å‘ä¼šè¯

2. **OBSè½¬å½•å®¢æˆ·ç«¯**:
   - ä»é»˜è®¤è¾“å…¥è®¾å¤‡æ•è·éŸ³é¢‘
   - å°†éŸ³é¢‘æµä¼ è¾“åˆ°è½¬å½•æœåŠ¡å™¨
   - ä½¿ç”¨è½¬å½•ç»“æœæ›´æ–°OBSä¸­çš„æ–‡æœ¬æº
   - æä¾›é…ç½®å’Œç›‘æ§çš„ç”¨æˆ·ç•Œé¢

``` txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     WebSocket     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OBS       â”‚      éŸ³é¢‘æµ        â”‚              â”‚
â”‚ è½¬å½•å®¢æˆ·ç«¯   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚   Whisper    â”‚
â”‚             â”‚                   â”‚   æœåŠ¡å™¨      â”‚
â”‚             â”‚   æ–‡æœ¬ç»“æœ         â”‚              |
â”‚             â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚
       â”‚                                 â”‚
       â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBS Studio â”‚                   â”‚   OpenAI     â”‚
â”‚  æ–‡æœ¬æº     â”‚                   â”‚   Whisper    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   æ¨¡å‹       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ç³»ç»Ÿéœ€æ±‚

### æœåŠ¡å™¨éœ€æ±‚

- Python 3.8+
- torch
- whisper
- websockets
- numpy

### å®¢æˆ·ç«¯éœ€æ±‚

- Python 3.8+
- obsws-python
- websockets
- pyaudio
- tkinter (å¤§å¤šæ•°Pythonå‘è¡Œç‰ˆä¸­å·²åŒ…å«)

## ğŸ”§ å®‰è£…

### æœåŠ¡å™¨è®¾ç½®

1. å…‹éš†ä»“åº“:

   ```bash
   git clone https://github.com/LandmineHQ/whisper-server.git
   cd whisper-server
   ```

2. å®‰è£…ä¾èµ–é¡¹:

   ```bash
   pip install torch numpy websockets openai-whisper
   ```

3. è¿è¡ŒæœåŠ¡å™¨:

   ```bash
   python whisper_server.py
   ```

   é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨è¿è¡Œåœ¨ `0.0.0.0:8765`ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥ä¿®æ”¹:

   ```bash
   HOST=127.0.0.1 PORT=8000 python whisper_server.py
   ```

### å®¢æˆ·ç«¯è®¾ç½®

1. å®‰è£…é¢å¤–ä¾èµ–é¡¹:

   ```bash
   pip install obsws-python pyaudio
   ```

2. è¿è¡ŒOBSé›†æˆå®¢æˆ·ç«¯:

   ```bash
   python obs_transcription_client.py
   ```

## ğŸ® ä½¿ç”¨æŒ‡å—

### æœåŠ¡å™¨é…ç½®

æœåŠ¡å™¨ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œé…ç½®æç®€ã€‚ä¸»è¦è®¾ç½®å¯é€šè¿‡ç¯å¢ƒå˜é‡ä¿®æ”¹:

- `HOST`: æœåŠ¡å™¨ç»‘å®šåœ°å€ (é»˜è®¤: 0.0.0.0)
- `PORT`: æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 8765)

é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨åŠ è½½"tiny"çº§åˆ«çš„Whisperæ¨¡å‹ï¼Œä»¥å®ç°æ›´å¿«çš„å¤„ç†é€Ÿåº¦å’Œæ›´ä½çš„èµ„æºéœ€æ±‚ã€‚ä½ å¯ä»¥åœ¨ä»£ç ä¸­ä¿®æ”¹æ¨¡å‹å¤§å°(å¦‚"base", "small", "medium", "large", "large-v3-turbo")ã€‚

### OBSå®¢æˆ·ç«¯è®¾ç½®

1. **åœ¨OBS Studioä¸­å¯ç”¨WebSocketæœåŠ¡å™¨**:
   - è¿›å…¥å·¥å…· â†’ obs-websocketè®¾ç½®
   - å¯ç”¨WebSocketæœåŠ¡å™¨
   - å¦‚éœ€è¦ï¼Œè®¾ç½®å¯†ç 
   - è®°ä¸‹ç«¯å£å· (é»˜è®¤: 4455)

2. **åœ¨OBSä¸­åˆ›å»ºæ–‡æœ¬æº**:
   - åœ¨åœºæ™¯ä¸­æ·»åŠ æ–°çš„"æ–‡æœ¬ (GDI+)"æº
   - å‘½åå®ƒ (ä¾‹å¦‚, "è½¬å½•æ–‡æœ¬")
   - æ ¹æ®éœ€è¦é…ç½®å­—ä½“ã€å¤§å°ã€é¢œè‰²ç­‰

3. **é…ç½®å®¢æˆ·ç«¯**:
   - å¯åŠ¨OBSè½¬å½•å®¢æˆ·ç«¯
   - è¾“å…¥OBSè¿æ¥è¯¦æƒ… (ä¸»æœºã€ç«¯å£ã€å¯†ç )
   - ç‚¹å‡»"è¿æ¥OBS"å¹¶ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ä½ çš„æ–‡æœ¬æº
   - è¾“å…¥WebSocketæœåŠ¡å™¨URL (ä¾‹å¦‚, ws://localhost:8765)
   - ç‚¹å‡»"è¿æ¥è½¬å½•æœåŠ¡å™¨"
   - ä¸¤ä¸ªè¿æ¥éƒ½å»ºç«‹åï¼Œç‚¹å‡»"å¼€å§‹è½¬å½•"

4. **ä¿å­˜é…ç½®**:
   - ç‚¹å‡»"ä¿å­˜è®¾ç½®"å°†é…ç½®ä¿å­˜ä»¥ä¾›å°†æ¥ä½¿ç”¨

## ğŸ“¡ WebSocket APIå‚è€ƒ

### è¿æ¥ç«¯ç‚¹

``` txt
ws://[æœåŠ¡å™¨åœ°å€]:[ç«¯å£]
```

é»˜è®¤ç«¯å£: `8765`

### æ¶ˆæ¯æ ¼å¼

#### æ§åˆ¶æ¶ˆæ¯ (å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨)

**åˆå§‹åŒ–è¯·æ±‚**:

```json
{
  "type": "init",
  "config": {
    "language": "zh",       // è¯­è¨€ä»£ç  (å¦‚ "zh", "en", "ja")
    "sample_rate": 16000,   // éŸ³é¢‘é‡‡æ ·ç‡ (Hz)
    "encoding": "LINEAR16", // éŸ³é¢‘ç¼–ç æ ¼å¼
    "channels": 1           // éŸ³é¢‘é€šé“æ•°
  }
}
```

**ç»“æŸä¼šè¯è¯·æ±‚**:

```json
{
  "type": "end"
}
```

#### éŸ³é¢‘æ•°æ®

éŸ³é¢‘é€šè¿‡WebSocketäºŒè¿›åˆ¶å¸§å‘é€:

- PCM 16ä½æ•´æ•°ï¼Œå°ç«¯å­—èŠ‚åº
- é‡‡æ ·ç‡ä¸åˆå§‹åŒ–é…ç½®åŒ¹é…
- é€šé“æ•°ä¸åˆå§‹åŒ–é…ç½®åŒ¹é…

#### æœåŠ¡å™¨å“åº”

**åˆå§‹åŒ–ç¡®è®¤**:

```json
{
  "type": "init_ack",
  "session_id": "uuidå­—ç¬¦ä¸²",
  "status": "ready"
}
```

**è½¬å½•ç»“æœ**:

```json
{
  "type": "transcription",
  "text": "è½¬å½•çš„æ–‡æœ¬å†…å®¹",
  "is_final": true,
  "language": "zh"
}
```

**ç»“æŸä¼šè¯ç¡®è®¤**:

```json
{
  "type": "end_ack",
  "session_id": "uuidå­—ç¬¦ä¸²"
}
```

**é”™è¯¯æ¶ˆæ¯**:

```json
{
  "type": "error",
  "code": "é”™è¯¯ä»£ç ",
  "message": "é”™è¯¯æè¿°"
}
```

## ğŸ” æ€§èƒ½è€ƒé‡

- æœåŠ¡å™¨ä½¿ç”¨æ¯ä¼šè¯ä¸€çº¿ç¨‹æ¨¡å‹ï¼Œé‡‡ç”¨éé˜»å¡I/O
- éŸ³é¢‘ä»¥çº¦50-100æ¯«ç§’çš„å—è¿›è¡Œå¤„ç†
- ç³»ç»Ÿç»´æŠ¤æœ‰é™çš„éŸ³é¢‘å†å²è®°å½•ï¼Œç”¨äºä¸Šä¸‹æ–‡æ„ŸçŸ¥è½¬å½•
- è½¬å½•ç»“æœä»¥æœ€å°å»¶è¿Ÿå®æ—¶æä¾›
- OBSå®¢æˆ·ç«¯åŒ…å«éŸ³é¢‘ååé‡çš„ç»Ÿè®¡ç›‘æ§åŠŸèƒ½

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

- è‡ªåŠ¨æ¸…ç†ä¸æ´»è·ƒä¼šè¯(5åˆ†é’Ÿè¶…æ—¶)
- é€šè¿‡WebSocketæ¶ˆæ¯æä¾›å¥å£®çš„é”™è¯¯æŠ¥å‘Š
- ä¼˜é›…å¤„ç†è¿æ¥ä¸­æ–­
- å®¢æˆ·ç«¯å…·å¤‡è‡ªåŠ¨é‡è¿èƒ½åŠ›

## ğŸ“ æœ€ä½³å®è·µ

1. **éŸ³é¢‘è´¨é‡**:
   - ä½¿ç”¨16kHzæˆ–æ›´é«˜é‡‡æ ·ç‡è·å¾—æœ€ä½³è¯†åˆ«æ•ˆæœ
   - ç¡®ä¿éº¦å…‹é£è¾“å…¥è´¨é‡é«˜ï¼Œå‡å°‘èƒŒæ™¯å™ªéŸ³

2. **ç½‘ç»œä¼˜åŒ–**:
   - åœ¨ç½‘ç»œæ¡ä»¶è¾ƒå·®çš„æƒ…å†µä¸‹è€ƒè™‘å¢åŠ éŸ³é¢‘ç¼“å†²åŒºå¤§å°
   - ç›‘æ§WebSocketè¿æ¥çŠ¶æ€

3. **èµ„æºç®¡ç†**:
   - ä½¿ç”¨å®Œæ¯•åæ˜¾å¼ç»“æŸä¼šè¯
   - ä¸ä½¿ç”¨æ—¶æ–­å¼€è¿æ¥ï¼Œéœ€è¦æ—¶é‡æ–°è¿æ¥

4. **éšç§è€ƒè™‘**:
   - å‘ŠçŸ¥ç”¨æˆ·éŸ³é¢‘æ•°æ®å°†è¢«å‘é€åˆ°æœåŠ¡å™¨å¤„ç†
   - è€ƒè™‘å®ç°éŸ³é‡æ£€æµ‹åŠŸèƒ½ï¼Œåªä¼ è¾“æœ‰å£°éŸ³çš„éŸ³é¢‘

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤æ‹‰å–è¯·æ±‚ã€‚

## ğŸ“„ è®¸å¯è¯

è¯¥é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - è¯¦æƒ…è¯·å‚é˜…LICENSEæ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- [OpenAI Whisper](https://github.com/openai/whisper) æä¾›è¯­éŸ³è¯†åˆ«æ¨¡å‹
- [OBS Studio](https://obsproject.com/) æä¾›æµåª’ä½“è½¯ä»¶
- [obsws-python](https://github.com/aiovideostudio/obsws-python) æä¾›OBS WebSocketé›†æˆ

---

è¯¦ç»†APIæ–‡æ¡£ï¼Œè¯·å‚é˜… [server.md](docs/server.md)ã€‚
